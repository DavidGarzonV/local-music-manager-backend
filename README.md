# LOCAL MUSIC MANAGER - API

API backend that lets you search for songs on your computer, find matches and add them to custom YouTube Music playlists.

The app uses the library [ytmusicapi](https://ytmusicapi.readthedocs.io/en/stable/) to automate interactions with YouTube Music.

## Necessary Installations

### Create a local environment:

```bash
virtualenv env
```

**Execute environment:**

Windows:
```bash
cd .venv/Scripts/ & activate.bat & cd ../../
```

Linux:
```bash
source .venv/Scripts/activate
```

### Install dependencies:

```bash
pip install -r requirements.txt
```
### Create a environment file:

Create a root file called `.env` based on file `.env.example`

## Run the application

```bash
py entrypoint.py
```

### To configure the authentication on Google

- Sign in or create an account in [Google Console](https://console.cloud.google.com/)
- Create a new project
- Go to "APIs & Services" product
- Select "Credentials"
- Create "OAuth client ID" credentials, and select "Web Application"
- Add "Authorized JavaScript origins" like "http://127.0.0.1:5000"
- Add "Authorized redirect URIs" like "https://davidgarzonv.github.io/local-music-manager-auth"
- Save and store generated credentials.

**Remember that you have a quota for development applications**:

- https://support.google.com/cloud/answer/7454865?sjid=15998940582297245958-NA
- https://support.google.com/cloud/answer/9028764

**Disable environment:**

```bash
deactivate
```

### API Documentation

[Swagger documentation](docs/collection.swagger.yaml)

## Package the application into an executable:

- Update the `.env` changing the environment for `production`

Execute the command:

```bash
pyinstaller entrypoint.spec --clean
```

The application will be located at: `dist/entrypoint/localmusicmanager.exe`
- It is important to keep the `_internal` folder along with the executable for it's use.

---

A little snippet to get the session values generated by Google, needed for the endpoint (api/v1/auth/session):

```javascript
// Create a URL object
const parsedUrl = new URL(window.location.href);

// Get the search parameters
const params = parsedUrl.searchParams;

// Retrieve the state and code
const state = params.get('state');
const code = params.get('code');

console.log({ state, code });
```
